<div class="split-nav">
  <aside>
    <nav>
      <details open>
        <summary>Type</summary>
        <ul>
          <li>
            <a href="<%= Termin::Web::Url.index_url(query: Termin::Web::Url.query(status: request.params['status']), request:) %>">
              All
            </a>
          </li>
          <% @run_types.each do |run_type| %>
            <li>
              <a href="<%= Termin::Web::Url.index_url(query: Termin::Web::Url.query(type: run_type, status: request.params['status']), request:) %>">
                <%= run_type %>
              </a>
            </li>
          <% end %>
        </ul>
      </details>
    </nav>
  </aside>

  <section>
    <%= erb :pager %>

    <form method="get">
      <div class="grid">
        <div>
          <select name="status" title="status" onchange="this.form.submit()">
            <option value="">All</option>
            <% @run_statuses.each do |run_status| %>
              <option value="<%= run_status %>" <% if params['status'] == run_status %>selected<% end %>><%= run_status %></option>
            <% end %>
          </select>
        </div>

        <div>
          <input type="hidden" name="type" value="<%= request.params['type'] %>">
          <input type="submit" value="Filter">
        </div>

        <div>
          <a href="<%= Termin::Web::Url.index_url(query: nil, request: request) %>" role="button" class="outline">Reset</a>
        </div>
      </div>
    </form>

    <% @running_logs.each do |log| %>
      <article>
        <header aria-busy="true" align="center"><%= log[:status] %></header>

        <table>
          <tbody>
            <% [:id, :start_at, :type].each do |col| %>
              <tr>
                <th scope="row"><strong><%= col.to_s %></strong></th>
                <td><%= log[col] %></td>
              </tr>
            <% end %>
          </tbody>
        </table>

        <footer align="center">
          <nav>
            <ul>
              <li>
                <a href="<%= ENV['VNC_URL'] %>" role="button" class="secondary outline" target="_blank">VNC</a>
              </li>

              <li>
                <a href="<%= ENV['SELENIUM_URL'] %>" role="button" class="secondary outline" target="_blank">Selenium</a>
              </li>
            </ul>
          </nav>
        </footer>
      </article>
    <% end %>

    <% if @run_logs.empty? %>
      <article>
        <i>No results found.</i>
      </article>
    <% else %>
      <table role="grid">
        <thead>
          <tr>
            <th scope="col">id</th>
            <th scope="col">start</th>
            <th scope="col" class="sm-hidden">time</th>
            <th scope="col">type</th>
            <th scope="col">status</th>
          </tr>
        </thead>

        <tbody>
          <% @run_logs.each do |log| %>
            <tr>
              <th scope="row">
                <a href="<%= Termin::Web::Url.run_url(log[:id], query: Termin::Web::Url.query(type: request.params['type'], status: request.params['status']), request:) %>"><%= log[:id] %></a><% if log[:keep] %>*<% end %>
              </th>
              <td><%= log[:start_at].strftime('%m.%d %H:%M')  %></td>
              <td class="sm-hidden">
                <% unless log[:end_at].nil? %>
                  <%= (log[:end_at] - log[:start_at]).round(2) %>
                <% end %>
              </td>

              <td>
                <code>
                  <a href="<%= Termin::Web::Url.index_url(query: Termin::Web::Url.query(type: log[:type], status: request.params['status']), request:) %>">
                    <%= log[:type] %>
                  </a>
                </code>
              </td>

              <td>
                <a href="<%= Termin::Web::Url.index_url(query: Termin::Web::Url.query(type: request.params['type'], status: log[:status]), request:) %>">
                  <%= log[:status] %>
                </a>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>

    <%= erb :pager %>
  </section>
</div>
